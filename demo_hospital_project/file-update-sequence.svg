<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="585px" preserveAspectRatio="none" style="width:690px;height:585px;" version="1.1" viewBox="0 0 690 585" width="690px" zoomAndPan="magnify"><defs><filter height="300%" id="fsodfz7akjl1h" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="36" x2="36" y1="70.1201" y2="513.9272"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="177" x2="177" y1="70.1201" y2="513.9272"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="318" x2="318" y1="70.1201" y2="513.9272"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="485" x2="485" y1="70.1201" y2="513.9272"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="665" x2="665" y1="70.1201" y2="513.9272"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="5" y="67.0439">文件接口</text><path d="M15.5,23 L15.5,47 M15.5,35 L32.5,35 " fill="none" filter="url(#fsodfz7akjl1h)" style="stroke:#A80036;stroke-width:2.0;"/><ellipse cx="44.5" cy="35" fill="#FEFECE" filter="url(#fsodfz7akjl1h)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="5" y="528.9712">文件接口</text><path d="M15.5,536.0474 L15.5,560.0474 M15.5,548.0474 L32.5,548.0474 " fill="none" filter="url(#fsodfz7akjl1h)" style="stroke:#A80036;stroke-width:2.0;"/><ellipse cx="44.5" cy="548.0474" fill="#FEFECE" filter="url(#fsodfz7akjl1h)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="139" y="67.0439">文件控制类</text><ellipse cx="177" cy="35" fill="#FEFECE" filter="url(#fsodfz7akjl1h)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="173,23,179,18,177,23,179,28,173,23" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="139" y="528.9712">文件控制类</text><ellipse cx="177" cy="548.0474" fill="#FEFECE" filter="url(#fsodfz7akjl1h)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="173,536.0474,179,531.0474,177,536.0474,179,541.0474,173,536.0474" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#fsodfz7akjl1h)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="84" x="274" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="281" y="55.0439">文件服务类</text><rect fill="#FEFECE" filter="url(#fsodfz7akjl1h)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="84" x="274" y="512.9272"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="281" y="535.9712">文件服务类</text><rect fill="#FEFECE" filter="url(#fsodfz7akjl1h)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="84" x="441" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="448" y="55.0439">文件数据类</text><rect fill="#FEFECE" filter="url(#fsodfz7akjl1h)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="84" x="441" y="512.9272"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="448" y="535.9712">文件数据类</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="641" y="67.0439">数据库</text><path d="M647,15 C647,5 665,5 665,5 C665,5 683,5 683,15 L683,41 C683,51 665,51 665,51 C665,51 647,51 647,41 L647,15 " fill="#FEFECE" filter="url(#fsodfz7akjl1h)" style="stroke:#000000;stroke-width:1.5;"/><path d="M647,15 C647,25 665,25 665,25 C665,25 683,25 683,15 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="641" y="528.9712">数据库</text><path d="M647,542.0474 C647,532.0474 665,532.0474 665,532.0474 C665,532.0474 683,532.0474 683,542.0474 L683,568.0474 C683,578.0474 665,578.0474 665,578.0474 C665,578.0474 647,578.0474 647,568.0474 L647,542.0474 " fill="#FEFECE" filter="url(#fsodfz7akjl1h)" style="stroke:#000000;stroke-width:1.5;"/><path d="M647,542.0474 C647,552.0474 665,552.0474 665,552.0474 C665,552.0474 683,552.0474 683,542.0474 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><polygon fill="#A80036" points="165,99.8745,175,103.8745,165,107.8745,169,103.8745" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="36" x2="171" y1="103.8745" y2="103.8745"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="43" y="99.0181">发送文件</text><polygon fill="#A80036" points="306,131.6289,316,135.6289,306,139.6289,310,135.6289" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177" x2="312" y1="135.6289" y2="135.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="184" y="130.7725">调用图像上传接口</text><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="360" y1="185.1377" y2="185.1377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="360" x2="360" y1="185.1377" y2="198.1377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="319" x2="360" y1="198.1377" y2="198.1377"/><polygon fill="#A80036" points="329,194.1377,319,198.1377,329,202.1377,325,198.1377" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="325" y="162.5269">解析文件的sha256值，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="325" y="180.2813">判断文件是否已经存在</text><polygon fill="#A80036" points="473,225.8921,483,229.8921,473,233.8921,477,229.8921" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="479" y1="229.8921" y2="229.8921"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="325" y="225.0356">先尝试插入新的文件数据</text><polygon fill="#A80036" points="653,257.6465,663,261.6465,653,265.6465,657,261.6465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="485" x2="659" y1="261.6465" y2="261.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="492" y="256.79">将新的文件数据插入数据库</text><polygon fill="#A80036" points="496,269.6465,486,273.6465,496,277.6465,492,273.6465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="490" x2="664" y1="273.6465" y2="273.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="502" y="289.5444">返回插入数据库的结果</text><polygon fill="#A80036" points="329,301.4009,319,305.4009,329,309.4009,325,305.4009" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323" x2="484" y1="305.4009" y2="305.4009"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="335" y="321.2988">判断插入数据库的结果</text><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="360" y1="356.9097" y2="356.9097"/><line style="stroke:#A80036;stroke-width:1.0;" x1="360" x2="360" y1="356.9097" y2="369.9097"/><line style="stroke:#A80036;stroke-width:1.0;" x1="319" x2="360" y1="369.9097" y2="369.9097"/><polygon fill="#A80036" points="329,365.9097,319,369.9097,329,373.9097,325,369.9097" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="325" y="352.0532">存储文件</text><polygon fill="#A80036" points="188,377.9097,178,381.9097,188,385.9097,184,381.9097" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182" x2="317" y1="381.9097" y2="381.9097"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="194" y="397.8076">返回文件上传的结果</text><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="360" y1="451.1729" y2="451.1729"/><line style="stroke:#A80036;stroke-width:1.0;" x1="360" x2="360" y1="451.1729" y2="464.1729"/><line style="stroke:#A80036;stroke-width:1.0;" x1="319" x2="360" y1="464.1729" y2="464.1729"/><polygon fill="#A80036" points="329,460.1729,319,464.1729,329,468.1729,325,464.1729" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="325" y="428.562">如果文件上传失败，清除</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="325" y="446.3164">数据库中的数据</text><polygon fill="#A80036" points="47,472.1729,37,476.1729,47,480.1729,43,476.1729" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="41" x2="176" y1="476.1729" y2="476.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="53" y="492.0708">返回标准结构的结果</text><!--MD5=[68ca3daaeb363493e23ecee4bfe960d9]
@startuml file-update-sequence
skinparam responseMessageBelowArrow true
boundary 文件接口 as b
control  文件控制类 as control
participant 文件服务类 as service
participant 文件数据类 as mapper
database 数据库 as bd

b -> control : 发送文件
control -> service : 调用图像上传接口
service -> service : 解析文件的sha256值，\n判断文件是否已经存在
service -> mapper : 先尝试插入新的文件数据
mapper -> bd : 将新的文件数据插入数据库
bd -> mapper : 返回插入数据库的结果
mapper -> service : 判断插入数据库的结果
service -> service : 存储文件
service -> control : 返回文件上传的结果
service -> service : 如果文件上传失败，清除\n数据库中的数据
control -> b : 返回标准结构的结果
@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 GMT+08:00 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>